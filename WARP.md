# WARP.md

This file provides guidance to WARP (warp.dev) when working with code in this repository.

## Project Overview

ThinkLink is a collaborative knowledge management application that allows users to create, link, and discuss content blocks in a graph-based interface. The system features real-time collaboration, visual graph representations of connected knowledge, and threaded discussions on individual blocks.

## Development Commands

### Core Development
```bash
# Start development server (includes both client and server with hot reloading)
npm run dev

# Type check without emitting files
npm run check

# Build for production (client + server)
npm run build

# Start production server
npm run start
```

### Database Operations
```bash
# Push database schema changes (creates/updates tables)
npm run db:push

# Set up database connection (ensure DATABASE_URL is set)
export DATABASE_URL="your-postgresql-connection-string"
```

### Single File Development
```bash
# Run TypeScript files directly with tsx (useful for testing server components)
npx tsx server/index.ts

# Check specific TypeScript files
npx tsc --noEmit server/routes.ts
npx tsc --noEmit client/src/App.tsx
```

## Architecture Overview

### Monorepo Structure
- **`client/`** - React frontend built with Vite
- **`server/`** - Express.js REST API with WebSocket support
- **`shared/`** - Shared TypeScript types and database schema (Drizzle ORM)
- **`dist/`** - Production build output
- **`migrations/`** - Database migration files (generated by Drizzle Kit)

### Technology Stack

**Frontend:**
- **React 18** with TypeScript - Component framework
- **Vite** - Build tool and dev server with hot reloading
- **Wouter** - Lightweight client-side routing (not React Router)
- **TanStack Query** - Server state management and caching
- **Radix UI + shadcn/ui** - Accessible component primitives with consistent styling
- **Tailwind CSS** - Utility-first styling with CSS custom properties for theming
- **Framer Motion** - Animation library

**Backend:**
- **Express.js** - HTTP server framework
- **WebSocket** - Real-time bidirectional communication
- **Drizzle ORM** - Type-safe database queries and schema management
- **PostgreSQL** - Primary database
- **Zod** - Runtime type validation and schema parsing

**Development:**
- **TypeScript 5.6** - Static typing across entire stack
- **ESBuild** - Fast production server bundling
- **tsx** - TypeScript execution for development

### Data Model

The application centers around three core entities:

- **Blocks** - Content units with position, tags, and metadata (support text/code/markdown)
- **Links** - Directed connections between blocks forming a knowledge graph
- **Comments** - Threaded discussions attached to blocks with nested reply support

### Real-time Features

WebSocket connection at `/ws` provides live updates for:
- Block creation, updates, and deletion
- Link establishment and removal
- Comment additions and nested replies
- Graph visualization changes

### API Design

RESTful endpoints follow the pattern:
- `GET /api/blocks` - List all blocks
- `GET /api/blocks/:id` - Get block with links and comments
- `POST /api/blocks` - Create new block
- `PUT /api/blocks/:id` - Update block
- `DELETE /api/blocks/:id` - Delete block
- `GET /api/search?q=query` - Search blocks
- `GET /api/graph` - Get full graph data for visualization

Link operations:
- `GET /api/links` - Get all links
- `POST /api/links` - Create link between blocks
- `DELETE /api/links/:id` - Remove link

Comment operations:
- `GET /api/blocks/:blockId/comments` - Get threaded comments for block
- `POST /api/blocks/:blockId/comments` - Add comment or reply
- `DELETE /api/comments/:id` - Delete comment

### Development Patterns

**Path Aliases:**
- `@/` maps to `client/src/`
- `@shared/` maps to `shared/`
- `@assets/` maps to `attached_assets/`

**Schema-First Development:**
- Database schema defined in `shared/schema.ts`
- Zod schemas auto-generated from Drizzle tables
- Type safety enforced from database to frontend

**Component Organization:**
- UI components use shadcn/ui patterns
- Radix primitives for accessibility
- Tailwind for styling with CSS custom properties
- Components are co-located with their specific functionality

### Environment Setup

**Required Environment Variables:**
```bash
DATABASE_URL=postgresql://user:password@host:port/database
NODE_ENV=development|production
PORT=5000  # Default port, required for production deployment
```

**Development vs Production:**
- Development: Vite dev server for client, tsx for server hot reloading
- Production: Static client build served by Express, bundled server with ESBuild

### Database Management

Uses Drizzle ORM with PostgreSQL:
- Schema changes made in `shared/schema.ts`
- Generate migrations: `drizzle-kit generate`
- Apply schema changes: `npm run db:push`
- Migration files output to `./migrations/` directory

### Testing Strategy

The codebase appears to prioritize type safety over extensive testing:
- TypeScript provides compile-time validation
- Zod schemas provide runtime validation
- Database constraints enforce data integrity
- Real-time updates tested through WebSocket connections

### Deployment Considerations

- Single HTTP server serves both API and static client files
- WebSocket connections require server that supports persistent connections
- Database migrations should be run before deployment
- Static assets built to `dist/public/`
- Server bundle output to `dist/index.js`

### Common Development Workflows

**Adding a New Feature:**
1. Define types in `shared/schema.ts` if database changes needed
2. Run `npm run db:push` to update database schema
3. Add API endpoints in `server/routes.ts`
4. Add real-time updates via WebSocket broadcasting
5. Create React components in `client/src/components/`
6. Add routing in `client/src/App.tsx` if needed
7. Use TanStack Query for server state management

**Debugging Real-time Features:**
1. Check WebSocket connection in browser dev tools
2. Monitor `broadcastToClients()` calls in server logs
3. Verify WebSocket message handling in client components
4. Test with multiple browser tabs for collaborative features

**Performance Considerations:**
- TanStack Query handles caching and background updates
- WebSocket broadcasts to all connected clients
- Graph visualization may need optimization for large datasets
- Database queries include proper joins for related data